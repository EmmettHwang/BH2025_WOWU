<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="êµìœ¡ ì‹ ê·œìˆ˜ê°•ì‹ ì²­ í˜ì´ì§€">
    <meta name="theme-color" content="#3B82F6">

    <!-- Open Graph ë©”íƒ€ íƒœê·¸ (URL ê³µìœ  ì‹œ ë¯¸ë¦¬ë³´ê¸°) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ - ì‹ ê·œìˆ˜ê°•ì‹ ì²­">
    <meta property="og:description" content="ì˜¨ë¼ì¸ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ìˆ˜ê°•ì‹ ì²­í•˜ì„¸ìš”">
    <meta property="og:image" content="/og-image.png">
    <meta property="og:url" content="/register.html">
    <meta property="og:site_name" content="êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ - ì‹ ê·œìˆ˜ê°•ì‹ ì²­">
    <meta name="twitter:description" content="ì˜¨ë¼ì¸ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ìˆ˜ê°•ì‹ ì²­í•˜ì„¸ìš”">
    <meta name="twitter:image" content="/og-image.png">

    <title>êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ - ì‹ ê·œìˆ˜ê°•ì‹ ì²­</title>

    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">

    <!-- í…Œë§ˆ ë° ë¡œê³  ì¦‰ì‹œ ì ìš© -->
    <script>
        var __THEME_COLOR__ = null;
        var __LOGO_URL__ = null;
        try {
            const savedTheme = localStorage.getItem('system_theme');
            if (savedTheme) {
                const theme = JSON.parse(savedTheme);
                if (theme && theme.menubar) {
                    __THEME_COLOR__ = theme.menubar;
                }
            }
            __LOGO_URL__ = localStorage.getItem('logo_url');

            // íŒŒë¹„ì½˜ì„ ë¡œê³ ë¡œ ì„¤ì •
            if (__LOGO_URL__) {
                let faviconUrl = __LOGO_URL__;
                if (__LOGO_URL__.startsWith('ftp://')) {
                    faviconUrl = '/api/download-image?url=' + encodeURIComponent(__LOGO_URL__);
                }
                const favicon = document.querySelector('link[rel="icon"]');
                if (favicon) favicon.href = faviconUrl;
            }
        } catch(e) {
            console.error('í…Œë§ˆ ë¡œë“œ ì˜¤ë¥˜:', e);
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="container max-w-2xl mx-auto px-4">
        <!-- ê°€ì… ì¹´ë“œ -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- í—¤ë” -->
            <script>document.write('<div id="register-header" class="p-6 text-center" style="background: ' + (__THEME_COLOR__ || '#2563eb') + ';">');</script>
                <div class="inline-block bg-white rounded-lg overflow-hidden mb-3" style="width: 160px; height: 64px;">
                    <script>
                        var logoSrc = __LOGO_URL__ || '/woosong-logo.png';
                        if (logoSrc.startsWith('ftp://')) {
                            logoSrc = '/api/download-image?url=' + encodeURIComponent(logoSrc);
                        }
                        document.write('<img id="register-logo" src="' + logoSrc + '" alt="ë¡œê³ " style="width: 100%; height: 100%; object-fit: fill;">');
                    </script>
                </div>
                <h1 id="system-title-register" class="text-xl font-bold text-white mb-1">ì‹ ê·œìˆ˜ê°•ì‹ ì²­</h1>
                <p class="text-blue-100 text-sm" id="system-subtitle1-register">ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
            </div>

            <!-- ê°€ì… í¼ -->
            <div class="p-6">
                <form id="registerForm" class="space-y-4">
                    <!-- ê³¼ì • ì„ íƒ (í•„ìˆ˜) - ë§¨ ìœ„ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-book mr-1"></i>ì‹ ì²­ ê³¼ì • <span class="text-red-500">*</span>
                        </label>
                        <select
                            id="courseCode"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                        >
                            <option value="">ê³¼ì •ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>

                    <!-- ì´ë¦„ (í•„ìˆ˜) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-user mr-1"></i>ì´ë¦„ <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="name"
                            placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                        >
                    </div>

                    <!-- ìƒë…„ì›”ì¼ (í•„ìˆ˜ - ë¡œê·¸ì¸ì— ì‚¬ìš©) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-birthday-cake mr-1"></i>ìƒë…„ì›”ì¼ <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="birthDate"
                            placeholder="ì˜ˆ: 900115 (6ìë¦¬)"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                        >
                        <p class="text-xs text-gray-500 mt-1">* ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤</p>
                    </div>

                    <!-- ì„±ë³„ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-venus-mars mr-1"></i>ì„±ë³„
                        </label>
                        <div class="flex gap-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="gender" value="ë‚¨" class="mr-2">
                                <span>ë‚¨</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="gender" value="ì—¬" class="mr-2">
                                <span>ì—¬</span>
                            </label>
                        </div>
                    </div>

                    <!-- íœ´ëŒ€í° (í•„ìˆ˜) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-phone mr-1"></i>íœ´ëŒ€í° <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="tel"
                            id="phone"
                            placeholder="010-0000-0000"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                            oninput="formatPhoneNumber(this)"
                        >
                    </div>

                    <!-- ì´ë©”ì¼ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-envelope mr-1"></i>ì´ë©”ì¼
                        </label>
                        <input
                            type="email"
                            id="email"
                            placeholder="example@email.com"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                        >
                    </div>

                    <!-- ì£¼ì†Œ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-map-marker-alt mr-1"></i>ì£¼ì†Œ
                        </label>
                        <input
                            type="text"
                            id="address"
                            placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                        >
                    </div>

                    <!-- í•™ë ¥ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-graduation-cap mr-1"></i>í•™ë ¥(í•™ë ¥ë¬´ê´€ì„ ë°œê°€ëŠ¥)
                        </label>
                        <input
                            type="text"
                            id="education"
                            placeholder="ì˜ˆ: 00ëŒ€í•™êµ 00í•™ê³¼ ì¡¸ì—…"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                        >
                    </div>

                    <!-- ê´€ì‹¬ë¶„ì•¼ (ì²´í¬ë°•ìŠ¤) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-heart mr-1"></i>ê´€ì‹¬ë¶„ì•¼
                        </label>
                        <div id="interestCheckboxes" class="grid grid-cols-2 md:grid-cols-3 gap-2 p-3 border-2 border-gray-200 rounded-lg bg-gray-50">
                            <!-- ì²´í¬ë°•ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            <p class="text-gray-400 text-sm col-span-full">ë¡œë”© ì¤‘...</p>
                        </div>
                        <input type="hidden" id="interests">
                    </div>

                    <!-- ìê¸°ì†Œê°œ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-comment mr-1"></i>ìê¸°ì†Œê°œ
                        </label>
                        <textarea
                            id="introduction"
                            rows="3"
                            placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none resize-none"
                        ></textarea>
                    </div>

                    <!-- í”„ë¡œí•„ ì‚¬ì§„ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-camera mr-1"></i>í”„ë¡œí•„ ì‚¬ì§„
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                            <!-- ë¯¸ë¦¬ë³´ê¸° -->
                            <div id="photoPreviewContainer" class="hidden mb-4">
                                <img id="photoPreview" src="" alt="í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°" class="w-32 h-32 mx-auto rounded-full object-cover border-4 border-blue-200">
                                <button type="button" onclick="removePhoto()" class="mt-2 text-red-500 text-sm hover:text-red-700">
                                    <i class="fas fa-trash mr-1"></i>ì‚¬ì§„ ì‚­ì œ
                                </button>
                            </div>
                            <!-- ì—…ë¡œë“œ ë²„íŠ¼ë“¤ -->
                            <div id="photoButtons" class="flex flex-col sm:flex-row gap-2 justify-center">
                                <label class="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all inline-flex items-center justify-center">
                                    <i class="fas fa-upload mr-2"></i>ì‚¬ì§„ ì—…ë¡œë“œ
                                    <input type="file" id="photoUpload" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                                </label>
                                <button type="button" onclick="openCamera()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all inline-flex items-center justify-center">
                                    <i class="fas fa-camera mr-2"></i>ì¹´ë©”ë¼ ì´¬ì˜
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">JPG, PNG íŒŒì¼ (ìµœëŒ€ 5MB)</p>
                        </div>
                        <input type="hidden" id="profilePhoto">
                    </div>

                    <!-- ì¹´ë©”ë¼ ëª¨ë‹¬ -->
                    <div id="cameraModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
                        <div class="bg-white rounded-2xl p-4 max-w-lg w-full mx-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold"><i class="fas fa-camera mr-2"></i>ì¹´ë©”ë¼ ì´¬ì˜</h3>
                                <button onclick="closeCamera()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="relative">
                                <video id="cameraVideo" autoplay playsinline class="w-full rounded-lg bg-black"></video>
                                <canvas id="cameraCanvas" class="hidden"></canvas>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button type="button" onclick="capturePhoto()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">
                                    <i class="fas fa-camera mr-2"></i>ì´¬ì˜
                                </button>
                                <button type="button" onclick="closeCamera()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-bold">
                                    <i class="fas fa-times mr-2"></i>ì·¨ì†Œ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ë²„íŠ¼ ì˜ì—­ -->
                    <div class="flex gap-3 pt-4">
                        <button
                            type="button"
                            onclick="window.location.href='/login.html'"
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition-all"
                        >
                            <i class="fas fa-arrow-left mr-2"></i>ì·¨ì†Œ
                        </button>
                        <button
                            type="submit"
                            id="submitButton"
                            class="flex-1 text-white font-bold py-3 rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:opacity-90"
                            style="background: #2563eb;"
                        >
                            <i class="fas fa-paper-plane mr-2"></i>ì‹ ì²­í•˜ê¸°
                        </button>
                    </div>
                    <script>
                        if (__THEME_COLOR__) {
                            document.getElementById('submitButton').style.background = __THEME_COLOR__;
                        }
                    </script>
                </form>

                <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
                <div id="alertMessage" class="hidden mt-4 p-4 rounded-lg"></div>
            </div>
        </div>

        <!-- í‘¸í„° -->
        <div class="text-center mt-6 text-gray-600 text-sm">
            <p>Â© 2025 êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ. All rights reserved.</p>
        </div>
    </div>

    <!-- ì„±ê³µ ëª¨ë‹¬ -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-3xl shadow-2xl max-w-lg mx-auto text-center transform transition-all duration-300 scale-95 hover:scale-100 overflow-hidden">
            <!-- ìƒë‹¨ ì¥ì‹ -->
            <div class="bg-gradient-to-r from-green-400 to-blue-500 h-2"></div>
            
            <div class="p-8 md:p-12">
                <!-- ì• ë‹ˆë©”ì´ì…˜ ì•„ì´ì½˜ -->
                <div class="relative inline-block mb-6">
                    <div class="absolute inset-0 bg-green-400 rounded-full opacity-25 animate-ping"></div>
                    <div class="relative text-green-500 text-7xl">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>

                <!-- í™˜ì˜ ë©”ì‹œì§€ -->
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4 leading-tight">
                    ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤!
                </h2>
                
                <div class="bg-white rounded-xl p-6 mb-6 shadow-inner">
                    <p class="text-lg text-gray-700 font-semibold mb-3">
                        ìˆ˜ê°• ì‹ ì²­ì´ ì•ˆì „í•˜ê²Œ<br>ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                    <div class="flex items-center justify-center text-blue-600 mb-3">
                        <i class="fas fa-phone-alt mr-2"></i>
                        <p class="text-base">
                            ë‹´ë‹¹ìê°€ ì •í•´ì§€ë©´<br>ë“±ë¡í•˜ì‹  ë²ˆí˜¸ë¡œ ì—°ë½ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="border-t border-gray-200 pt-3 mt-3">
                        <p class="text-sm text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>
                            ì‹ ì²­ ìƒíƒœëŠ” ë¡œê·¸ì¸ í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤
                        </p>
                    </div>
                </div>

                <!-- ë²„íŠ¼ë“¤ -->
                <div class="space-y-3">
                    <button
                        onclick="window.location.href='/login.html'"
                        id="modalLoginButton"
                        class="w-full text-white font-bold py-4 px-6 rounded-xl transition-all hover:shadow-xl transform hover:-translate-y-1 duration-200"
                        style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);"
                    >
                        <i class="fas fa-sign-in-alt mr-2"></i>ë¡œê·¸ì¸í•˜ëŸ¬ ê°€ê¸°
                    </button>
                    <button
                        onclick="window.location.href='/'"
                        class="w-full text-gray-700 font-semibold py-4 px-6 rounded-xl bg-white border-2 border-gray-200 transition-all hover:border-gray-300 hover:shadow-md transform hover:-translate-y-1 duration-200"
                    >
                        <i class="fas fa-home mr-2"></i>í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            </div>

            <!-- í•˜ë‹¨ ì¥ì‹ -->
            <div class="bg-gradient-to-r from-green-400 to-blue-500 h-2"></div>
        </div>
    </div>

    <style>
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        .animate-ping {
            animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        const API_BASE_URL = window.location.origin.replace('3000', '8000');

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ì§‘ì¤‘ì¸ ê³¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadOpenCourses() {
            try {
                // ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ ëª¨ì§‘ì¤‘ì¸ ê³¼ì • ì½”ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const settingsResponse = await axios.get(`${API_BASE_URL}/api/system-settings`);
                const openCourseCodes = settingsResponse.data.open_courses || '';

                // ì „ì²´ ê³¼ì • ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const coursesResponse = await axios.get(`${API_BASE_URL}/api/courses`);
                const allCourses = coursesResponse.data;

                const courseSelect = document.getElementById('courseCode');
                courseSelect.innerHTML = '<option value="">ê³¼ì •ì„ ì„ íƒí•˜ì„¸ìš”</option>';

                // ëª¨ì§‘ì¤‘ì¸ ê³¼ì •ë§Œ í•„í„°ë§
                let filteredCourses = allCourses;
                if (openCourseCodes && openCourseCodes.trim()) {
                    const openCodes = openCourseCodes.split(',').map(c => c.trim());
                    filteredCourses = allCourses.filter(course => openCodes.includes(course.code));
                }

                // ê³¼ì •ì´ ì—†ìœ¼ë©´ ì „ì²´ í‘œì‹œ
                if (filteredCourses.length === 0) {
                    filteredCourses = allCourses;
                }

                filteredCourses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.code;
                    option.textContent = course.name;
                    courseSelect.appendChild(option);
                });

                // ëª¨ì§‘ì¤‘ì¸ ê³¼ì •ì´ 1ê°œì¼ ë•Œ ìë™ ì„ íƒ
                if (filteredCourses.length === 1) {
                    courseSelect.value = filteredCourses[0].code;
                }

                console.log('ëª¨ì§‘ì¤‘ì¸ ê³¼ì • ë¡œë“œ ì™„ë£Œ:', filteredCourses.length + 'ê°œ');
            } catch (error) {
                console.error('ê³¼ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‹œìŠ¤í…œ ì„¤ì • ë¡œë“œ
        async function loadSystemSettings() {
            try {
                const response = await axios.get(`${API_BASE_URL}/api/system-settings`);
                const settings = response.data;

                // ì œëª© ì—…ë°ì´íŠ¸
                const systemTitle = settings.system_title || 'êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ';
                document.title = systemTitle + ' - ì‹ ê·œê°€ì…';

                // ë¡œê³  ì—…ë°ì´íŠ¸
                const logoImg = document.getElementById('register-logo');
                if (logoImg && settings.logo_url) {
                    if (settings.logo_url.startsWith('ftp://')) {
                        logoImg.src = API_BASE_URL + '/api/download-image?url=' + encodeURIComponent(settings.logo_url);
                    } else {
                        logoImg.src = settings.logo_url;
                    }
                }

                // ê´€ì‹¬ë¶„ì•¼ í‚¤ì›Œë“œ ë¡œë“œ ë° ì²´í¬ë°•ìŠ¤ ìƒì„± (ê¸°ë³¸ê°’ í¬í•¨)
                const defaultKeywords = 'AI, ë¡œë´‡, ë¹…ë°ì´í„°, í”„ë¡œê·¸ë˜ë°, í—¬ìŠ¤ì¼€ì–´, ë°ì´í„°ì—”ì§€ë‹ˆì–´, ë°ì´í„°ê³¼í•™ì, ì˜ê³¼í•™ì, MLì—”ì§€ë‹ˆì–´, AIë³´ì•ˆì—”ì§€ë‹ˆì–´, AI APPê°œë°œ, ì„ë² ë””ë“œ&ì˜¨ë””ë°”ì´ìŠ¤AI, ì „ë¬¸ë„ë©”ì¸ìœµí•©, ì²¨ë‹¨ì‚°ì—…AX, AI HWì—”ì§€ë‹ˆì–´';
                loadInterestKeywords(settings.interest_keywords || defaultKeywords);
            } catch (error) {
                console.error('ì‹œìŠ¤í…œ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ê´€ì‹¬ë¶„ì•¼ í‚¤ì›Œë“œ ì²´í¬ë°•ìŠ¤ ìƒì„±
        function loadInterestKeywords(keywordsStr) {
            const container = document.getElementById('interestCheckboxes');
            container.innerHTML = '';

            if (!keywordsStr || !keywordsStr.trim()) {
                container.innerHTML = '<p class="text-gray-400 text-sm col-span-full">ê´€ì‹¬ë¶„ì•¼ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</p>';
                return;
            }

            const keywords = keywordsStr.split(',').map(k => k.trim()).filter(k => k);

            if (keywords.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm col-span-full">ê´€ì‹¬ë¶„ì•¼ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</p>';
                return;
            }

            keywords.forEach((keyword, idx) => {
                const label = document.createElement('label');
                label.className = 'flex items-center cursor-pointer p-2 rounded hover:bg-gray-100 transition-colors';
                label.innerHTML = `
                    <input type="checkbox" name="interest" value="${keyword}" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <span class="text-sm text-gray-700">${keyword}</span>
                `;
                container.appendChild(label);
            });

            // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ hidden input ì—…ë°ì´íŠ¸
            container.querySelectorAll('input[name="interest"]').forEach(cb => {
                cb.addEventListener('change', updateInterestsInput);
            });
        }

        // ì„ íƒëœ ê´€ì‹¬ë¶„ì•¼ë¥¼ hidden inputì— ì €ì¥
        function updateInterestsInput() {
            const checkboxes = document.querySelectorAll('input[name="interest"]:checked');
            const selected = Array.from(checkboxes).map(cb => cb.value);
            document.getElementById('interests').value = selected.join(', ');
        }

        // íœ´ëŒ€í° ë²ˆí˜¸ ìë™ í˜•ì‹í™” (000-0000-0000)
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ

            if (value.length > 11) {
                value = value.substring(0, 11);
            }

            if (value.length > 7) {
                input.value = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7);
            } else if (value.length > 3) {
                input.value = value.substring(0, 3) + '-' + value.substring(3);
            } else {
                input.value = value;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            loadSystemSettings();
            loadOpenCourses();
        });

        // ì¹´ë©”ë¼ ê´€ë ¨ ë³€ìˆ˜
        let cameraStream = null;

        // í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ ì²˜ë¦¬
        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showAlert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤', 'error');
                event.target.value = '';
                return;
            }

            // ì´ë¯¸ì§€ íŒŒì¼ ì²´í¬
            if (!file.type.startsWith('image/')) {
                showAlert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                event.target.value = '';
                return;
            }

            // ë¯¸ë¦¬ë³´ê¸°ìš© dataUrl ë¨¼ì € ìƒì„±
            const reader = new FileReader();
            reader.onload = async function(e) {
                const dataUrl = e.target.result;
                
                try {
                    // FTP ì—…ë¡œë“œ ì‹œë„
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('directory', 'student_profiles');

                    const response = await fetch(`${API_BASE_URL}/api/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const photoUrl = result.file_url;
                        // FTP ì—…ë¡œë“œ ì„±ê³µ - URL ì €ì¥
                        setPhotoPreview(dataUrl, photoUrl);
                        console.log('âœ… FTP ì—…ë¡œë“œ ì„±ê³µ:', photoUrl);
                    } else {
                        // FTP ì—…ë¡œë“œ ì‹¤íŒ¨ - base64ë¡œ í´ë°±
                        console.warn('âš ï¸ FTP ì—…ë¡œë“œ ì‹¤íŒ¨, base64ë¡œ ì €ì¥');
                        setPhotoPreview(dataUrl, dataUrl);
                    }
                } catch (error) {
                    // FTP ì—…ë¡œë“œ ì—ëŸ¬ - base64ë¡œ í´ë°±
                    console.error('ì‚¬ì§„ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                    console.warn('âš ï¸ FTP ì—…ë¡œë“œ ì‹¤íŒ¨, base64ë¡œ ì €ì¥');
                    setPhotoPreview(dataUrl, dataUrl);
                }
            };
            reader.readAsDataURL(file);
        }

        // ì¹´ë©”ë¼ ì—´ê¸°
        async function openCamera() {
            const cameraModal = document.getElementById('cameraModal');
            const video = document.getElementById('cameraVideo');

            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }
                });
                video.srcObject = cameraStream;
                cameraModal.classList.remove('hidden');
                cameraModal.classList.add('flex');
            } catch (err) {
                console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:', err);
                showAlert('ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ì¹´ë©”ë¼ ë‹«ê¸°
        function closeCamera() {
            const cameraModal = document.getElementById('cameraModal');
            const video = document.getElementById('cameraVideo');

            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            video.srcObject = null;
            cameraModal.classList.add('hidden');
            cameraModal.classList.remove('flex');
        }

        // ì‚¬ì§„ ì´¬ì˜
        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            // JPEG íŒŒì¼ë¡œ ë³€í™˜
            canvas.toBlob(async (blob) => {
                const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                
                try {
                    // FTP ì—…ë¡œë“œ ì‹œë„
                    const formData = new FormData();
                    const filename = `profile_${Date.now()}.jpg`;
                    formData.append('file', blob, filename);
                    formData.append('directory', 'student_profiles');

                    const response = await fetch(`${API_BASE_URL}/api/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const photoUrl = result.file_url;
                        // FTP ì—…ë¡œë“œ ì„±ê³µ - URL ì €ì¥
                        setPhotoPreview(dataUrl, photoUrl);
                        console.log('âœ… FTP ì—…ë¡œë“œ ì„±ê³µ:', photoUrl);
                    } else {
                        // FTP ì—…ë¡œë“œ ì‹¤íŒ¨ - base64ë¡œ í´ë°±
                        console.warn('âš ï¸ FTP ì—…ë¡œë“œ ì‹¤íŒ¨, base64ë¡œ ì €ì¥');
                        setPhotoPreview(dataUrl, dataUrl);
                    }
                    closeCamera();
                } catch (error) {
                    // FTP ì—…ë¡œë“œ ì—ëŸ¬ - base64ë¡œ í´ë°±
                    console.error('ì‚¬ì§„ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                    console.warn('âš ï¸ FTP ì—…ë¡œë“œ ì‹¤íŒ¨, base64ë¡œ ì €ì¥');
                    setPhotoPreview(dataUrl, dataUrl);
                    closeCamera();
                }
            }, 'image/jpeg', 0.8);
        }

        // ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
        function setPhotoPreview(dataUrl, photoUrl = null) {
            const preview = document.getElementById('photoPreview');
            const previewContainer = document.getElementById('photoPreviewContainer');
            const photoButtons = document.getElementById('photoButtons');

            preview.src = dataUrl;
            document.getElementById('profilePhoto').value = photoUrl || dataUrl;

            previewContainer.classList.remove('hidden');
            photoButtons.classList.add('hidden');
        }

        // ì‚¬ì§„ ì‚­ì œ
        function removePhoto() {
            const preview = document.getElementById('photoPreview');
            const previewContainer = document.getElementById('photoPreviewContainer');
            const photoButtons = document.getElementById('photoButtons');

            preview.src = '';
            document.getElementById('profilePhoto').value = '';
            document.getElementById('photoUpload').value = '';

            previewContainer.classList.add('hidden');
            photoButtons.classList.remove('hidden');
        }

        // ìƒë…„ì›”ì¼ ê²€ì¦
        function validateBirthDate(birthDate) {
            if (!birthDate) return false;

            // ìˆ«ìë§Œ ì¶”ì¶œ
            const digits = birthDate.replace(/\D/g, '');

            // 6ìë¦¬ì¸ì§€ í™•ì¸
            if (digits.length !== 6) return false;

            // ìœ íš¨í•œ ë‚ ì§œì¸ì§€ í™•ì¸
            const year = parseInt(digits.substring(0, 2));
            const month = parseInt(digits.substring(2, 4));
            const day = parseInt(digits.substring(4, 6));

            if (month < 1 || month > 12) return false;
            if (day < 1 || day > 31) return false;

            return true;
        }

        // í¼ ì œì¶œ
        const registerForm = document.getElementById('registerForm');
        const submitButton = document.getElementById('submitButton');
        const alertMessage = document.getElementById('alertMessage');
        const successModal = document.getElementById('successModal');

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const courseCode = document.getElementById('courseCode').value;
            const phone = document.getElementById('phone').value.trim();
            const birthDate = document.getElementById('birthDate').value.trim();

            if (!name) {
                showAlert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            if (!courseCode) {
                showAlert('ê³¼ì •ì„ ì„ íƒí•˜ì„¸ìš”', 'error');
                return;
            }

            // ìƒë…„ì›”ì¼ 6ìë¦¬ í•„ìˆ˜ ê²€ì¦
            if (!birthDate) {
                showAlert('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤)', 'error');
                document.getElementById('birthDate').focus();
                return;
            }

            if (!validateBirthDate(birthDate)) {
                showAlert('ìƒë…„ì›”ì¼ì„ 6ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 900115)', 'error');
                document.getElementById('birthDate').focus();
                return;
            }

            if (!phone) {
                showAlert('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ì‹ ì²­ ì¤‘...';

            try {
                const genderRadio = document.querySelector('input[name="gender"]:checked');

                const data = {
                    name: name,
                    course_code: courseCode,
                    birth_date: birthDate.replace(/\D/g, ''),  // ìˆ«ìë§Œ ì €ì¥
                    gender: genderRadio ? genderRadio.value : '',
                    phone: phone,
                    email: document.getElementById('email').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    education: document.getElementById('education').value.trim(),
                    interests: document.getElementById('interests').value.trim(),
                    introduction: document.getElementById('introduction').value.trim(),
                    profile_photo: document.getElementById('profilePhoto').value
                };

                const response = await axios.post(`${API_BASE_URL}/api/student-registrations`, data);

                if (response.data.id) {
                    // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
                    successModal.classList.remove('hidden');
                    successModal.classList.add('flex');
                }
            } catch (error) {
                console.error('ì‹ ì²­ ì˜¤ë¥˜:', error);
                const message = error.response?.data?.detail || 'ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
                showAlert(message, 'error');

                // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>ì‹ ì²­í•˜ê¸°';
            }
        });

        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
        function showAlert(message, type) {
            alertMessage.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');

            if (type === 'error') {
                alertMessage.classList.add('bg-red-100', 'text-red-800');
                alertMessage.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
            } else if (type === 'success') {
                alertMessage.classList.add('bg-green-100', 'text-green-800');
                alertMessage.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
            }

            alertMessage.classList.remove('hidden');

            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                alertMessage.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
